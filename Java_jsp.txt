Jenkins and Tomcat port changes(if any)
/opt/tomcat/conf/server.xml ---> <Connector port

1.Java_compile
Build steps:In the build steps, select invoke top level maven targets. Use the tool maven(plugin priorly downloaded).
Goals: clean validate compile


2.Java_codeReview
Triggers:
To achieve the CI/CD pipeline, enable build after another projects are built. Select the project after which you want to trigger this project. In this we need to trigger it after Java_compile build is stable.
Build Steps:
Goals: -P metrics pmd:pmd checkstyle:checkstyle findbugs:findbugs
Post-buils actions:
Record compiler warnings and static analysis results using the tools
*PMD (A source code analyzer for Java and other languages)
*CheckStyle (A tool to check Java source code for adherence to coding standards)
*FindBugs (A static analysis tool for Java bytecode to find potential bugs)


3.Java_testcases
Triggers:
To achieve the CI/CD pipeline, enable build after another projects are built. Select the project after which you want to trigger this project. In this we need to trigger it after Java_codeReview build is stable.
Build steps:In the build steps, select invoke top level maven targets. Use the tool maven(plugin priorly downloaded).
Goals: test
Post-buils Steps:
Publish JUnit test result report
Specify the test report XMLs path --> target/surefire-reports/*.xml


4.Java_deploy
Triggers:
To achieve the CI/CD pipeline, enable build after another projects are built. Select the project after which you want to trigger this project. In this we need to trigger it after Java_testcases build is stable.
Build steps: In the build steps, select invoke top level maven targets. Use the tool maven(plugin priorly downloaded).
Goals: package

The above steps are for baremetal

5.Java_docker
Docker--->Triggers --> Select build after other projects are built--> select last baremetal project
   Build steps -->1.Execute shell --> give below two commannds
     docker build -t mavenapp:latest -f Dockerfile .
     docker run -d -p 8080:8080 --name mavenapp mavenapp:latest
   Build steps -->2.Docker build and publish --->Give Repository name--> gaganahs/your_repo_name --> Tag v1 --> Registry creds
   (select docker creds)

6.Java K8
   Kubernetes --> Triggers --> Select build after other projects are built--> select docker
   Build steps --> Deploy to kubernetes --> Select kubeconfig --> Give .yaml(service and deployment) file names in config


#Dockerfile for jar

#This one requires you to run:
#mvn clean package

FROM eclipse-temurin:17-jdk
WORKDIR /app

COPY target/*.jar app.jar

EXPOSE 8080

ENTRYPOINT ["java", "-jar", "app.jar"]

#Dockerfile for war

# ===== Build Stage =====
FROM maven:3.9.9-eclipse-temurin-17 AS build
WORKDIR /app

COPY . .
RUN mvn clean package -DskipTests

# ===== Runtime Stage =====
FROM tomcat:9.0-jdk17

# Remove default apps
RUN rm -rf /usr/local/tomcat/webapps/*

# Copy built WAR as ROOT app
COPY --from=build /app/target/*.war /usr/local/tomcat/webapps/ROOT.war

EXPOSE 8080
CMD ["catalina.sh", "run"]


#Deployment file

apiVersion: apps/v1
kind: Deployment

metadata:
  name: book

spec:
  replicas: 1

  selector:
    matchLabels:
      app: book

  template:
    metadata:
      labels:
        app: book

    spec:
      containers:
      - name: book
        image: gaganahs/phpapp:latest
        ports:
        - containerPort: 8080

#service file

apiVersion: v1
kind: Service
metadata:
  name: tomcat-service
spec:
  selector:
    app: tomcat
  ports:
  - protocol: TCP
    port: 8080
    targetPort: 8080
    nodePort: 30081
  type: NodePort

